
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Default-deny all reads and writes
    match /{document=**} {
      allow read, write: if false;
    }
    
    // Allow authenticated users to read from any collection they need to.
    match /orders/{orderId} {
      allow read, write: if request.auth != null;
    }
    match /leads/{leadId} {
      allow read, write: if request.auth != null;
    }
    match /seller_products/{productId} {
        allow read, write: if request.auth != null;
    }
    match /product_drops/{dropId} {
      allow read, write: if request.auth != null;
    }
     match /chats/{chatId} {
      allow read, write: if request.auth != null;
    }
     match /chats/{chatId}/messages/{messageId} {
      allow read, write: if request.auth != null;
    }

    // Allow users to create their own profile documents
    match /seller_users/{userId} {
      allow read, write: if request.auth != null;
    }

    match /vendors/{userId} {
      allow read, write: if request.auth != null;
    }
    
    match /payPartners/{partnerId} {
        allow read, write: if request.auth != null;
    }
    
    match /topUpRequests/{requestId} {
        allow read, write: if request.auth != null;
    }
    
    match /partner_transactions/{txId} {
        allow read, write: if request.auth != null;
    }
    
    match /cash_codes/{codeId} {
        allow read, write: if request.auth != null;
    }
    
    match /partnerCancellations/{cancellationId} {
        allow read, write: if request.auth != null;
    }

    // Allow authenticated users to manage their own settings
     match /seller_payment_settings/{userId} {
      allow read, write: if request.auth.uid == userId || get(/databases/$(database)/documents/seller_users/$(request.auth.uid)).data.role == 'admin';
    }
     match /vendor_payment_settings/{userId} {
      allow read, write: if request.auth.uid == userId || get(/databases/$(database)/documents/seller_users/$(request.auth.uid)).data.role == 'admin';
    }

    // Admins can manage user permissions
    match /user_permissions/{userId} {
        allow read, write: if request.auth != null; // Simplified for now
    }

    // Shakti Card rules
    match /shakti_cards/{cardId} {
        allow read, write: if request.auth != null;
    }
     match /shakti_card_rules_db/{dbId} {
        allow read, write: if request.auth != null;
    }
    
     match /payment_info/{paymentId} {
        allow read, write: if request.auth != null;
    }
  }
}
